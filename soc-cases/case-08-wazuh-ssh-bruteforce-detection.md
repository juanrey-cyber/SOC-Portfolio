# SOC Case 08 — Wazuh Detection of SSH Brute Force Attempts (Ubuntu)

## Overview
This case documents the detection and investigation of repeated SSH authentication failures consistent with a brute-force attempt. Evidence was identified in Linux authentication logs (`/var/log/auth.log`) and correlated with alerts generated by Wazuh (Threat Hunting + Security Alerts). The goal is to confirm what happened, validate whether compromise occurred, and define response/hardening actions following SOC best practices.

---

## Environment
- **Host:** Ubuntu-lab
- **OS:** Ubuntu Linux
- **Analyst user:** `analyst`
- **Log source:** `/var/log/auth.log`
- **Monitored access:** SSH
- **SIEM/Platform:** Wazuh (manager/agent/dashboard)

---

## Detection

### A) Linux log detection
Repeated SSH authentication failures were observed in `/var/log/auth.log`, including invalid-user attempts and failed passwords.

**Command used**
```bash

sudo grep -nE "Failed password|Invalid user|authentication failure" /var/log/auth.log | tail -n 80
Observed indicators

High frequency of failed attempts in a short time window

Attempts against non-existent usernames (e.g., fakeuser)

PAM authentication failures

Connection closed after repeated failures

Example entries (format varies by system):

Dec 23 20:53:44 Ubuntu-lab sshd[5056]: Failed password for invalid user fakeuser from 127.0.0.1 port 54321
Dec 23 20:53:46 Ubuntu-lab sshd[5056]: Failed password for invalid user fakeuser from 127.0.0.1 port 54321
Dec 23 20:53:57 Ubuntu-lab sshd[5056]: Connection closed by invalid user fakeuser

B) Wazuh detection

Wazuh surfaced related alerts in:

Threat Hunting overview (events + MITRE mapping)

Security Alerts table for the Ubuntu-lab agent

Key observation: alerts were generated, but no very high-severity levels were observed (per dashboard view).

Investigation
1) Confirm affected host and analyst user

hostname
whoami
id analyst

Result: Host confirmed as Ubuntu-lab; analyst context validated.

2) Confirm brute-force pattern in auth log

sudo grep -nE "Failed password|Invalid user|authentication failure" /var/log/auth.log | tail -n 120

What you’re looking for: multiple attempts clustered in time + repeated failures.

3) Identify targeted usernames (possible user enumeration)

sudo grep "Invalid user" /var/log/auth.log | awk '{print $(NF-5)}' | sort | uniq -c | sort -nr | head

nterpretation: repeated “Invalid user X” suggests automated guessing of usernames.

4) Identify source IP(s)

sudo grep -E "Failed password|Invalid user" /var/log/auth.log \
| grep -oE "from ([0-9]{1,3}\.){3}[0-9]{1,3}" \
| awk '{print $2}' | sort | uniq -c | sort -nr | head

Result in your lab: 127.0.0.1 (localhost) → consistent with a controlled simulation.

5) Check for successful authentication (compromise validation)

sudo grep -E "Accepted password|Accepted publickey" /var/log/auth.log | tail -n 50

What you’re looking for: attacker logs in → then uses sudo / opens root session.

MITRE ATT&CK Mapping

T1110 — Brute Force: repeated SSH authentication failures

T1078 — Valid Accounts (Attempted): credential guessing against potential accounts

Assessment
What happened?

Repeated SSH authentication failures consistent with a brute-force attempt (or simulated brute-force) against the SSH service on Ubuntu-lab.

Was the host compromised?

No evidence of compromise found in this dataset:

No “Accepted password/publickey” events observed for the attack window

Activity originated from localhost in the lab (127.0.0.1)

Severity

Low (Lab / Simulated).
(If this were external/public IP in production, severity increases.)

Response & Recommendations
Immediate actions (production scenario)

Block offending IP(s) at firewall/security group

Enable brute-force protections (fail2ban / rate limiting)

Increase monitoring sensitivity for repeated failures

SSH hardening

Disable password auth; use SSH keys only

Disable root SSH login

Restrict SSH access (allowlist/VPN/bastion)

Strong passwords + MFA where applicable (for admin access paths)

Wazuh improvements

Create/tune rules for “N failed attempts in X minutes”

Saved searches dashboards for:

Invalid user attempts

Failed passwords

Accepted logins after multiple failures

sudo escalation after SSH login

Lessons Learned (Interview-ready)

Always validate SIEM alerts by correlating back to raw logs

Confirm: attacker source, target user(s), success vs failure, and post-auth behavior

Document: timeline, evidence, ATT&CK mapping, severity, and remediation

Appendix — Commands Used

hostname
whoami
id analyst

sudo grep -nE "Failed password|Invalid user|authentication failure" /var/log/auth.log | tail -n 80
sudo grep "Invalid user" /var/log/auth.log | awk '{print $(NF-5)}' | sort | uniq -c | sort -nr | head
sudo grep -E "Failed password|Invalid user" /var/log/auth.log | grep -oE "from ([0-9]{1,3}\.){3}[0-9]{1,3}" | awk '{print $2}' | sort | uniq -c | sort -nr | head
sudo grep -E "Accepted password|Accepted publickey" /var/log/auth.log | tail -n 50
sudo grep -E "sudo:|session opened for user root|COMMAND=" /var/log/auth.log | tail -n 80
